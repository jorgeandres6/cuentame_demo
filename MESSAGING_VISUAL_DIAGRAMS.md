# ğŸ“Š Diagramas de Arquitectura - Sistema de MensajerÃ­a CUÃ‰NTAME\n\n## 1. Arquitectura General del Sistema\n\n```\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\nâ”ƒ                   CUÃ‰NTAME - SISTEMA DE GESTIÃ“N DE CONFLICTOS       â”ƒ\nâ”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›\n\n     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n     â”‚         FRONTEND (React 18 + TypeScript)                 â”‚\n     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n              â”‚                                 â”‚\n              â”‚                                 â”‚\n     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”\n     â”‚  CaseDetail.tsx â”‚              â”‚ Messaging       â”‚\n     â”‚                 â”‚              â”‚ Interface.tsx   â”‚\n     â”‚  SecciÃ³n #6:    â”‚              â”‚                 â”‚\n     â”‚  Hilo de Conv.  â”‚              â”‚ PestaÃ±a Casos   â”‚\n     â”‚                 â”‚              â”‚ PestaÃ±a Conv.   â”‚\n     â”‚ [âœ‰ï¸ Enviar]     â”‚              â”‚                 â”‚\n     â”‚ [ğŸ“‹ Mensajes]   â”‚              â”‚ [ğŸ“Œ Casos]      â”‚\n     â”‚                 â”‚              â”‚ [ğŸ‘¥ Usuarios]   â”‚\n     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n              â”‚                                 â”‚\n              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n              â”‚  storageService.ts       â”‚\n              â”‚  (Funciones HTTP)        â”‚\n              â”‚                          â”‚\n              â”‚ â€¢ sendMessageWithCase()  â”‚\n              â”‚ â€¢ getMessagesByCase()    â”‚\n              â”‚ â€¢ getConversationByCase()â”‚\n              â”‚ â€¢ groupMessagesByCase()  â”‚\n              â”‚ â€¢ getLastMessageByCase() â”‚\n              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n              â”‚   Backend REST API       â”‚\n              â”‚   (server.js)            â”‚\n              â”‚                          â”‚\n              â”‚ â€¢ POST /send-case        â”‚\n              â”‚ â€¢ GET /by-case/{id}      â”‚\n              â”‚ â€¢ GET /inbox             â”‚\n              â”‚ â€¢ PUT /{id}/read         â”‚\n              â”‚ â€¢ DELETE /{id}           â”‚\n              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n              â”‚   Azure SQL Database     â”‚\n              â”‚                          â”‚\n              â”‚ â€¢ messages table         â”‚\n              â”‚ â€¢ case_messages table    â”‚\n              â”‚ â€¢ Ãndices por caso       â”‚\n              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## 2. Flujo de ComunicaciÃ³n Bidireccional\n\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘                     FLUJO COMPLETO DE MENSAJERÃA                       â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nSTAFF GESTIONA CASO #1234                USUARIO (Estudiante)\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                                                                       â”‚\nâ”‚  1. Abre CaseDetail (Caso #1234)      1. Abre MessagingInterface    â”‚\nâ”‚     â–¼                                     â–¼                          â”‚\nâ”‚  2. Desplaza a SecciÃ³n #6             2. Ve pestaÃ±a \"ğŸ“‹ Casos\"      â”‚\nâ”‚     â–¼                                     â–¼                          â”‚\nâ”‚  3. Ve Hilo de ConversaciÃ³n           3. Ve \"Caso #1234 (2 sin leer)\"â”‚\nâ”‚     â”œâ”€ Mensajes previos               â–¼                             â”‚\nâ”‚     â”œâ”€ Estado de respuestas        4. Hace click en caso            â”‚\nâ”‚     â””â”€ Ãšltimo mensaje                 â–¼                             â”‚\nâ”‚     â–¼                              5. Ve hilo completo               â”‚\nâ”‚  4. Escribe respuesta                 â”œâ”€ Mensaje del staff           â”‚\nâ”‚     â”‚                                 â””â”€ Mensajes anteriores         â”‚\nâ”‚     â”‚                                    â–¼                           â”‚\nâ”‚     â–¼                              6. Escribe respuesta              â”‚\nâ”‚  5. [âœ‰ï¸ Enviar Mensaje]                â”‚                             â”‚\nâ”‚     (conversationId=1234)             â–¼                             â”‚\nâ”‚     â”‚                             7. [Enviar]                       â”‚\nâ”‚     â”‚                                â”‚                              â”‚\nâ”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜                             â”‚\nâ”‚              â”‚ HTTP POST           â”‚                               â”‚\nâ”‚              â”‚ /api/messages/       â”‚                               â”‚\nâ”‚              â”‚ send-case            â”‚                               â”‚\nâ”‚              â–¼                      â–¼                               â”‚\nâ”‚         Backend                 Frontend                            â”‚\nâ”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚\nâ”‚         â”‚ 1. Validar staff            â”‚                            â”‚\nâ”‚         â”‚ 2. Crear Message:           â”‚                            â”‚\nâ”‚         â”‚    â€¢ conversationId=1234    â”‚                            â”‚\nâ”‚         â”‚    â€¢ caseId=1234            â”‚                            â”‚\nâ”‚         â”‚    â€¢ status=UNREAD          â”‚                            â”‚\nâ”‚         â”‚ 3. INSERT BD                â”‚                            â”‚\nâ”‚         â”‚ 4. Response {id, conv}      â”‚                            â”‚\nâ”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚\nâ”‚              â”‚                       â”‚                              â”‚\nâ”‚              â–¼                       â–¼                              â”‚\nâ”‚         Frontend                 Frontend                           â”‚\nâ”‚         actualiza lista        getInbox() busca                     â”‚\nâ”‚                                 nuevos mensajes                     â”‚\nâ”‚              â–¼                       â–¼                              â”‚\nâ”‚  6. Ver respuesta en           7. Ve en \"Caso #1234\":             â”‚\nâ”‚     auto-actualizaciÃ³n             â€¢ Nuevo mensaje del staff        â”‚\nâ”‚     (cada 10 segundos)             â€¢ Contador actualizado           â”‚\nâ”‚     âœ… ConversaciÃ³n completa   âœ… Puede responder nuevamente        â”‚\nâ”‚                                                                       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## 3. Estructura de Datos - Message\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚           OBJETO MESSAGE (types.ts)          â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                              â”‚\nâ”‚  id: \"msg_001\"                               â”‚\nâ”‚  âœ“ Identificador Ãºnico                       â”‚\nâ”‚                                              â”‚\nâ”‚  senderId: \"usr_001\"                         â”‚\nâ”‚  senderCode: \"STAFF_USER\"  â—„â”€â”€ Staff       â”‚\nâ”‚  senderRole: \"STAFF\"                         â”‚\nâ”‚  âœ“ InformaciÃ³n del remitente                 â”‚\nâ”‚                                              â”‚\nâ”‚  recipientId: \"usr_123\"                      â”‚\nâ”‚  recipientCode: \"EST-2024-A\" â—„â”€â”€ Estudiante â”‚\nâ”‚  recipientRole: \"STUDENT\"                    â”‚\nâ”‚  âœ“ InformaciÃ³n del destinatario              â”‚\nâ”‚                                              â”‚\nâ”‚  content: \"AquÃ­ estÃ¡ la soluciÃ³n...\"        â”‚\nâ”‚  âœ“ Contenido del mensaje                     â”‚\nâ”‚                                              â”‚\nâ”‚  status: \"UNREAD\"                            â”‚\nâ”‚  âœ“ Estados: UNREAD | READ | DELETED         â”‚\nâ”‚                                              â”‚\nâ”‚  messageType: \"TEXT\"                         â”‚\nâ”‚  âœ“ Tipos: TEXT | FILE | MEDIA | ALERT       â”‚\nâ”‚                                              â”‚\nâ”‚  *** CRÃTICO ***                             â”‚\nâ”‚  conversationId: \"1234\" â—„â”€â”€ ID del Caso    â”‚\nâ”‚  caseId: \"1234\"       â—„â”€â”€ Referencia       â”‚\nâ”‚  âœ“ VinculaciÃ³n a caso                        â”‚\nâ”‚  âœ“ conversationId = caseId GARANTIZADO       â”‚\nâ”‚                                              â”‚\nâ”‚  createdAt: \"2024-01-19T10:30:00Z\"          â”‚\nâ”‚  readAt: \"2024-01-19T10:35:00Z\"             â”‚\nâ”‚  âœ“ Timestamps auditados                      â”‚\nâ”‚                                              â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## 4. Vista de Componentes\n\n### CaseDetail - SecciÃ³n #6 (NUEVA)\n\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘          6. HILO DE CONVERSACIÃ“N (conversationId = 1234)            â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘                                                                     â•‘\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘\nâ•‘  â”‚ ÃREA DE MENSAJES (max-height: 400px, overflow-y: auto)    â”‚  â•‘\nâ•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â•‘\nâ•‘  â”‚                                                             â”‚  â•‘\nâ•‘  â”‚  ğŸ‘¤ Estudiante - 19/01 10:00                               â”‚  â•‘\nâ•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â•‘\nâ•‘  â”‚  â”‚ Tengo un conflicto con mi compaÃ±ero de clase       â”‚ â”‚  â•‘\nâ•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â•‘\nâ•‘  â”‚  [UNREAD]                                                  â”‚  â•‘\nâ•‘  â”‚                                                             â”‚  â•‘\nâ•‘  â”‚                    ğŸ‘¨â€ğŸ’¼ Staff - 19/01 10:30                   â”‚  â•‘\nâ•‘  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â•‘\nâ•‘  â”‚          â”‚ Te recomiendo hablar con Ã©l primero      â”‚      â”‚  â•‘\nâ•‘  â”‚          â”‚ Si no se resuelve, avÃ­same              â”‚      â”‚  â•‘\nâ•‘  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â•‘\nâ•‘  â”‚          [READ]                                             â”‚  â•‘\nâ•‘  â”‚                                                             â”‚  â•‘\nâ•‘  â”‚  ğŸ‘¤ Estudiante - 19/01 10:45                               â”‚  â•‘\nâ•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â•‘\nâ•‘  â”‚  â”‚ Ya lo intentÃ© pero no quiso escucharme             â”‚ â”‚  â•‘\nâ•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â•‘\nâ•‘  â”‚  [UNREAD]                                                  â”‚  â•‘\nâ•‘  â”‚                                                             â”‚  â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘\nâ•‘                                                                     â•‘\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘\nâ•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â•‘\nâ•‘  â”‚ â”‚ Escribir mensaje directo al usuario (se vincula    â”‚  â”‚  â•‘\nâ•‘  â”‚ â”‚ automÃ¡ticamente a este caso)...                    â”‚  â”‚  â•‘\nâ•‘  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â•‘\nâ•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â•‘\nâ•‘  â”‚ â”‚ âœ‰ï¸ Enviar Mensaje (conversationId=1234)             â”‚  â”‚  â•‘\nâ•‘  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘\nâ•‘                                                                     â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n### MessagingInterface - Vista de Casos (NUEVA)\n\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘                     BUZÃ“N DE MENSAJES                              â•‘\nâ•‘  [ğŸ“‹ Casos] [ğŸ‘¥ Conversaciones]                                   â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘                                                                     â•‘\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â•‘\nâ•‘  â”‚ ğŸ“Œ Caso #1234    ğŸ”´2 â”‚  â† NÃºmero de sin leer                    â•‘\nâ•‘  â”‚                      â”‚                                          â•‘\nâ•‘  â”‚ \"Tengo un conflicto   â”‚  â† Preview del Ãºltimo mensaje           â•‘\nâ•‘  â”‚  con...              â”‚                                          â•‘\nâ•‘  â”‚ 4 mensajes           â”‚  â† Total de mensajes en este caso        â•‘\nâ•‘  â”‚ Ãšltimo: 19/01        â”‚  â† Fecha del Ãºltimo mensaje              â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â•‘\nâ•‘                                                                     â•‘\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â•‘\nâ•‘  â”‚ ğŸ“Œ Caso #5678    ğŸ”´1 â”‚                                           â•‘\nâ•‘  â”‚                      â”‚                                          â•‘\nâ•‘  â”‚ \"Falta a clases...    â”‚                                          â•‘\nâ•‘  â”‚                      â”‚                                          â•‘\nâ•‘  â”‚ 7 mensajes           â”‚                                          â•‘\nâ•‘  â”‚ Ãšltimo: 18/01        â”‚                                          â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â•‘\nâ•‘                                                                     â•‘\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â•‘\nâ•‘  â”‚ ğŸ“Œ Caso #9012        â”‚  â† Sin mensajes sin leer                 â•‘\nâ•‘  â”‚                      â”‚                                          â•‘\nâ•‘  â”‚ \"Comportamiento en... â”‚                                          â•‘\nâ•‘  â”‚                      â”‚                                          â•‘\nâ•‘  â”‚ 12 mensajes          â”‚                                          â•‘\nâ•‘  â”‚ Ãšltimo: 17/01        â”‚                                          â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â•‘\nâ•‘                                                                     â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n        â”‚ Click en caso\n        â–¼\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘       Caso #1234 - conversationId=1234                             â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘                                                                     â•‘\nâ•‘  ğŸ‘¨â€ğŸ’¼ STAFF_USER - 19/01 10:30                                       â•‘\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘\nâ•‘  â”‚ Te recomiendo hablar con Ã©l primero                      â”‚     â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘\nâ•‘                                                                     â•‘\nâ•‘  ğŸ‘¤ EST-2024-A - 19/01 10:45                                       â•‘\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘\nâ•‘  â”‚ Ya lo intentÃ© pero no quiso escucharme                   â”‚     â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘\nâ•‘                                                                     â•‘\nâ•‘  [input] Responder en Caso #1234... [Enviar]                      â•‘\nâ•‘                                                                     â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n---\n\n## 5. Ciclo de Vida de un Mensaje\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                CICLO DE VIDA DE UN MENSAJE                          â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n  CREACIÃ“N\n    â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ sendMessage() o                     â”‚\nâ”‚ sendMessageWithCase()               â”‚\nâ”‚                                     â”‚\nâ”‚ âœ“ conversationId = caseId           â”‚\nâ”‚ âœ“ status = \"UNREAD\"                 â”‚\nâ”‚ âœ“ createdAt = NOW()                 â”‚\nâ”‚ âœ“ readAt = NULL                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n  ALMACENAMIENTO\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ INSERT INTO messages (...)          â”‚\nâ”‚ INSERT INTO case_messages (...)      â”‚\nâ”‚                                     â”‚\nâ”‚ âœ“ ID Ãºnico generado                 â”‚\nâ”‚ âœ“ Ãndices creados                   â”‚\nâ”‚ âœ“ RelaciÃ³n caso-mensaje             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n  NOTIFICACIÃ“N\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Avisar a usuario                    â”‚\nâ”‚ (por implementar)                   â”‚\nâ”‚                                     â”‚\nâ”‚ âœ“ Email (opcional)                  â”‚\nâ”‚ âœ“ Push notification (opcional)      â”‚\nâ”‚ âœ“ In-app notification (obligatorio) â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n  ENTREGA\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Usuario ve mensaje en:              â”‚\nâ”‚                                     â”‚\nâ”‚ â€¢ Staff: CaseDetail SecciÃ³n #6      â”‚\nâ”‚ â€¢ Usuario: MessagingInterface       â”‚\nâ”‚          > PestaÃ±a Casos            â”‚\nâ”‚          > Click en caso            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n  LECTURA\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ markAsRead(messageId)               â”‚\nâ”‚                                     â”‚\nâ”‚ âœ“ status = \"READ\"                   â”‚\nâ”‚ âœ“ readAt = NOW()                    â”‚\nâ”‚ âœ“ Contador actualiza                â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n  ARCHIVO\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Mensaje archivado                   â”‚\nâ”‚ (cuando caso se cierra)             â”‚\nâ”‚                                     â”‚\nâ”‚ âœ“ Disponible en historial           â”‚\nâ”‚ âœ“ No elimina nunca                  â”‚\nâ”‚ âœ“ Auditable permanentemente         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n  ELIMINACIÃ“N LÃ“GICA (Soft Delete)\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ deleteMessage(messageId)            â”‚\nâ”‚                                     â”‚\nâ”‚ âœ“ status = \"DELETED\"                â”‚\nâ”‚ âœ“ deletedAt = NOW()                 â”‚\nâ”‚ âœ“ NO elimina de BD                  â”‚\nâ”‚ âœ“ No visible en queries             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## 6. Matriz de Flujos por Rol\n\n```\nSTAFF                           USUARIO (Est/Pad/Doc)\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ 1. Abre Caso            â”‚    â”‚ 1. Abre Inbox       â”‚\nâ”‚    â–¼                    â”‚    â”‚    â–¼                â”‚\nâ”‚ 2. Ve SecciÃ³n #6        â”‚    â”‚ 2. PestaÃ±a \"Casos\" â”‚\nâ”‚    â–¼                    â”‚    â”‚    â–¼                â”‚\nâ”‚ 3. Lee mensajes         â”‚    â”‚ 3. Ve \"Caso #1234\" â”‚\nâ”‚    â–¼                    â”‚    â”‚    â–¼                â”‚\nâ”‚ 4. Escribe respuesta    â”‚    â”‚ 4. Click en caso    â”‚\nâ”‚    â–¼                    â”‚    â”‚    â–¼                â”‚\nâ”‚ 5. [âœ‰ï¸ Enviar]          â”‚    â”‚ 5. Lee hilo         â”‚\nâ”‚    â”‚                    â”‚    â”‚    â–¼                â”‚\nâ”‚    â”œâ”€â–º HTTP POST        â”‚    â”‚ 6. Escribe respuestaâ”‚\nâ”‚    â”‚                    â”‚    â”‚    â–¼                â”‚\nâ”‚    â–¼                    â”‚    â”‚ 7. [Enviar]         â”‚\nâ”‚ 6. Auto-actualizaciÃ³n   â”‚    â”‚    â”‚                â”‚\nâ”‚    (cada 10s)           â”‚    â”‚    â”œâ”€â–º HTTP POST    â”‚\nâ”‚    â–¼                    â”‚    â”‚    â”‚                â”‚\nâ”‚ 7. Ve respuesta del     â”‚    â”‚    â–¼                â”‚\nâ”‚    usuario              â”‚    â”‚ 8. Aparece en Inboxâ”‚\nâ”‚                         â”‚    â”‚                    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n        â”‚                              â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                       â–¼\n              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n              â•‘ conversationId â•‘\n              â•‘   = caseId     â•‘\n              â•‘   = \"1234\"     â•‘\n              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n                       â”‚\n                       â–¼\n            AUDITORÃA COMPLETADA âœ“\n            TRAZABILIDAD GARANTIZADA âœ“\n```\n\n---\n\n## 7. Comparativa: Antes vs DespuÃ©s\n\n```\nANTES (Sistema Antiguo)               DESPUÃ‰S (Sistema Nuevo)\n\nMensajerÃ­a GenÃ©rica                   MensajerÃ­a Vinculada a Casos\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Usuarios se comunican       â”‚      â”‚ Usuarios se comunican en el  â”‚\nâ”‚ sin contexto de caso        â”‚      â”‚ contexto especÃ­fico del caso  â”‚\nâ”‚                             â”‚      â”‚                              â”‚\nâ”‚ Staff recibe mensajes en    â”‚      â”‚ Staff ve mensajes en la      â”‚\nâ”‚ un inbox genÃ©rico           â”‚      â”‚ gestiÃ³n del caso mismo       â”‚\nâ”‚                             â”‚      â”‚                              â”‚\nâ”‚ DifÃ­cil rastrear a quÃ©      â”‚      â”‚ conversationId = caseId      â”‚\nâ”‚ caso corresponde            â”‚      â”‚ Rastreo automÃ¡tico           â”‚\nâ”‚                             â”‚      â”‚                              â”‚\nâ”‚ Requiere bÃºsqueda manual    â”‚      â”‚ Agrupado por caso en inbox   â”‚\nâ”‚ para encontrar conversaciÃ³n â”‚      â”‚ Acceso inmediato             â”‚\nâ”‚                             â”‚      â”‚                              â”‚\nâ”‚ Sin vinculaciÃ³n explicit    â”‚      â”‚ VinculaciÃ³n explÃ­cita        â”‚\nâ”‚ en BD                       â”‚      â”‚ en conversationId y caseId    â”‚\nâ”‚                             â”‚      â”‚                              â”‚\nâ”‚ AuditorÃ­a incompleta        â”‚      â”‚ AuditorÃ­a garantizada        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nRESULTADO:                           RESULTADO:\nBaja eficiencia en staff              âœ“ Alta eficiencia\nConfusiÃ³n en usuarios                 âœ“ Claridad total\nPÃ©rdida de contexto                   âœ“ Contexto siempre presente\nAuditorÃ­a dÃ©bil                       âœ“ AuditorÃ­a fuerte\n```\n\n---\n\n## 8. GestiÃ³n de Estados\n\n```\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚  NUEVO MENSAJE      â”‚\n                    â”‚  status = UNREAD    â”‚\n                    â”‚  readAt = NULL      â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                               â”‚\n                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                  â”‚                         â”‚\n           Usuario lo ve              Usuario no\n                  â”‚                    lo ve aÃºn\n                  â–¼                         â–¼\n           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          Queda esperando\n           â”‚  markAsRead()â”‚          en status UNREAD\n           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ Aparece badge\n                  â”‚                  â”‚ ğŸ”´ Sin leer\n                  â–¼                  â”‚\n         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚\n         â”‚ status = READ  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚ readAt = NOW() â”‚          Usuario lo lee\n         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ Se actualiza\n                  â”‚                  â”‚ readAt = NOW()\n                  â”‚                  â”‚ badge desaparece\n         [Mensaje leÃ­do]             â”‚\n                  â”‚                  â”‚\n                  â–¼                  â”‚\n         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚\n         â”‚ deleteMessage()â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚ (Usuario hace  â”‚          Staff puede eliminar\n         â”‚  clic eliminar)â”‚          para su vista\n         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                  â”‚\n                  â–¼\n         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n         â”‚ status=DELETED â”‚\n         â”‚ deletedAt=NOW()â”‚\n         â”‚                â”‚\n         â”‚ NO se borra    â”‚\n         â”‚ de BD         â”‚\n         â”‚ (Soft delete)  â”‚\n         â”‚                â”‚\n         â”‚ Auditable âœ“    â”‚\n         â”‚ Recuperable âœ“  â”‚\n         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\nEstos diagramas proporcionan una visualizaciÃ³n completa de la arquitectura de mensajerÃ­a CUÃ‰NTAME v2.0.\n"